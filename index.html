<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tank Penetration Calculator</title>
    <style>
        .container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 20px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="armor-stats">
            <h3>Armor Stats</h3>
            Armor Front: <input type="number" id="armorFront"><br>
            Armor Side: <input type="number" id="armorSide"><br>
            Armor Back: <input type="number" id="armorBack"><br>
            Health Points: <input type="number" id="healthPoints">
        </div>

        <div class="attack-stats">
            <h3>Attack Stats</h3>
            Range: <input type="number" id="range"><br>
            Attack Angle: <select id="attackAngle">
                <option value="front">Front</option>
                <option value="side">Side</option>
                <option value="back">Back</option>
            </select><br>
            Penetration Close: <input type="number" id="penetrationClose"><br>
            Penetration Middle: <input type="number" id="penetrationMiddle"><br>
            Penetration Far: <input type="number" id="penetrationFar"><br>
            Damage: <input type="number" id="damage"><br>
            Rounds per minute: <input type="number" id="roundsPerMinute">
        </div>
    </div>

    <div class="simulate">
        <button id="simulateButton" onclick="simulate()">Simulate</button>
    </div>

    <div id="results">
        <!-- Results will be displayed here -->
    </div>
    
    <canvas id="penetrationChart"></canvas>

    <script>
        function simulate() {
            // Get input values
            const armorFront = parseInt(document.getElementById("armorFront").value);
            const armorSide = parseInt(document.getElementById("armorSide").value);
            const armorBack = parseInt(document.getElementById("armorBack").value);
            const healthPoints = parseInt(document.getElementById("healthPoints").value);
            const range = parseInt(document.getElementById("range").value);
            const attackAngle = document.getElementById("attackAngle").value;
            const penetrationClose = parseInt(document.getElementById("penetrationClose").value);
            const penetrationMiddle = parseInt(document.getElementById("penetrationMiddle").value);
            const penetrationFar = parseInt(document.getElementById("penetrationFar").value);
            const damage = parseInt(document.getElementById("damage").value);
            const roundsPerMinute = parseInt(document.getElementById("roundsPerMinute").value);

            // Calculate armor stat based on attack angle
            let armor;
            if (attackAngle === 'front') {
                armor = armorFront;
            } else if (attackAngle === 'side') {
                armor = armorSide;
            } else {
                armor = armorBack;
            }

            // Calculate penetration based on range
            let penetrationValue;
            if (range <= 20) {
                penetrationValue = penetrationClose;
            } else if (range > 40) {
                penetrationValue = penetrationFar;
            } else {
                penetrationValue = penetrationMiddle;
            }

            // Calculate penetration chance
            let penetrationChance;
            if (penetrationValue >= armor) {
                penetrationChance = 100;
            } else {
                penetrationChance = (penetrationValue / armor) * 100;
            }

            // Calculate penetration chance
            let penetrationChanceGraphClose;
            if (penetrationClose >= armor) {
                penetrationChanceGraphClose = 100;
            } else {
                penetrationChanceGraphClose = (penetrationClose / armor) * 100;
            }

            let penetrationChanceGraphMid;
            if (penetrationMiddle >= armor) {
                penetrationChanceGraphMid = 100;
            } else {
                penetrationChanceGraphMid = (penetrationMiddle / armor) * 100;
            }

            let penetrationChanceGraphFar;
            if (penetrationFar >= armor) {
                penetrationChanceGraphFar = 100;
            } else {
                penetrationChanceGraphFar = (penetrationFar / armor) * 100;
            }

            // Calculate shots and time to kill the enemy tank
            let shotsToKill = 0;
            let successfulShots = 0;
            let remainingHealth = healthPoints;

            while (remainingHealth > 0) {
                let penetrationRoll = Math.random() * 100;
                shotsToKill++;
                if (penetrationRoll <= penetrationChance) {
                    remainingHealth -= damage;
                    successfulShots++;
                }
            }

            const timeToKill = (shotsToKill / roundsPerMinute) * 60;

            // Display results
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = `
                <p>Penetration Chance: ${penetrationChance.toFixed(2)}%</p>
                <p>Shots to Kill: ${successfulShots}</p>
                <p>Time to Kill: ${timeToKill.toFixed(2)} seconds</p>
            `;

            // Create the penetration chance graph
            const penetrationChartData = {
                labels: [0, 20, 40, range],
                datasets: [{
                    label: 'Penetration Chance',
                    data: [penetrationChanceGraphClose, penetrationChanceGraphClose, penetrationChanceGraphMid, penetrationChanceGraphFar],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    tension: 0.1,
                    fill: false,
                }]
            };

            const chartOptions = {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Range'
                        },
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Penetration Chance (%)'
                        },
                        min: 0,
                        max: 100,
                    }
                }
            };

            const ctx = document.getElementById("penetrationChart").getContext("2d");
            new Chart(ctx, {
                type: 'line',
                data: penetrationChartData,
                options: chartOptions,
            });
        }
    </script>
</body>
</html>
